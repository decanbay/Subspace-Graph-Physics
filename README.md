# Subspace Graph Physics: <br /> Real-Time Rigid Body-Driven Granular Flow Simulation
#### [[Paper](https://ieeexplore.ieee.org/abstract/document/9438132)]

This is a <strong>computationally efficient</strong> version of "Learning To Simulate" developed by [DeepMind](https://deepmind.com/research/publications/Learning-to-Simulate-Complex-Physics-with-Graph-Networks) and [Stanford](https://cs.stanford.edu/people/jure) researchers, for <strong>real-time 3D</strong> physics simulations, specially granular flows and their interactions with rigid bodies. The approach is developed under the supervision of Prof. [K. Skonieczny](http://users.encs.concordia.ca/~kskoniec/) (Concordia).

<img src="https://github.com/haeriamin/files/blob/master/excav_ml_4.gif" alt="drawing" width="820">

# Highlights

* We train the graph network (GN) model in subspace by performing Principal Component Analysis (PCA).

* PCA enables GN to be trained using a single desktop GPU with moderate VRAM for large 3D configurations.

* The training datasets can be generated by our efficient and accurate [Material Point Method](https://github.com/haeriamin/MPM-NGF) (MPM).

* The rollout runtime is under 1 sec/sec, and the training runtime is 60 global-step/sec (on NVIDIA RTX 3080).

* The particle positions and velocities, and rigid body interaction forces are compared above.

<!-- ## Code structure

* `run.py`: Runs the optimization.

    * The initial, lower and upper bounds of optimization variables are defined here.
        ```python
        X0 = [,]
        LB = [,]
        UB = [,]
        ```

    * Some other settings including loading/saving optimal solution, and excavation depth and time can also be set.
        ```python
        load = True/False
        save = True/False
        depths = [,]  # [m]
        sim_times = [,]  # [sec]
        ```


* `constr_nm.py`: Implements the constrained Nelder-Mead method [(reference)](https://github.com/alexblaessle/constrNMPy).

* `nelder_mead.py`: Implements the Nelder-Mead method [(reference)](https://github.com/scipy/scipy/blob/master/scipy/optimize/optimize.py).

    * This is modified to terminate the optimization loop when no significant error changes happen (e.g. `<1`%) during the last specified iterations by setting e.g. `history = 10` as fallows:

        ```python
        if iterations > history+2:
            for i in range(2,history+2):
                fval_sum += abs(fval_history[-1] - fval_history[-i])
            if fval_sum/history < 1:
                break
        ```

* `obj_func.py`: Implements the objective function.

    * The Vortex (excavation) model is called here and implemented in:

        ```python
        def run_vortex(self, x, depth):
            ...
        ```

    * The mean absolute percentage error (MAPE) is calculated using the results from Vortex and experiment.

    * The Vortex files and reference (experimental) results should already be provided in folder `input/`.


## Requirements

* VxSim
* numpy
* pickle -->

# Bibtex
Please cite our papers [[1](https://arxiv.org/abs/2111.01523), [2](https://ieeexplore.ieee.org/abstract/document/9438132)] if you use this code for your research: 
```
@INPROCEEDINGS{9438132,
    author={Haeri, A. and Skonieczny, K.},
    booktitle={2021 IEEE Aerospace Conference (50100)},
    title={Accurate and Real-time Simulation of Rover Wheel Traction},
    year={2021},
    volume={},
    number={},
    pages={1-9},
    doi={10.1109/AERO50100.2021.9438132}
}
```
and/or
```
@misc{haeri2021threedimensional,
      title={Three-dimensional granular flow continuum modeling via material point method with hyperelastic nonlocal granular fluidity}, 
      author={Amin Haeri and Krzysztof Skonieczny},
      year={2021},
      eprint={2111.01523},
      archivePrefix={arXiv},
      primaryClass={cond-mat.soft}
}
```
